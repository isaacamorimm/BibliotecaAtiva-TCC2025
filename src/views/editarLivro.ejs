<%- include('partials/header', { 
    title: 'Editar Livro - Biblioteca Ativa', 
    activePage: 'editarLivro',
    cssFile: 'editarLivro.css'
    /* jsFile FOI REMOVIDO DAQUI */
}) %>
            <div class="page-header">
                <h1 class="page-title">Editar Livro</h1>
                <p class="page-subtitle">Atualize as informações do livro</p>
            </div>

            <% if (error) { %>
                <div class="alert alert-error">
                    <i class="fas fa-exclamation-triangle alert-icon"></i>
                    <strong>Erro:</strong> <%= error %>
                </div>
            <% } %>

            <div class="book-info">
                <h3 class="info-title">
                    <i class="fas fa-info-circle"></i> Informações Atuais
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">ID</span>
                        <span class="info-value">#<%= livro.id %></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status</span>
                        <span class="info-value">
                            <span class="badge <%= livro.publicado ? 'badge-success' : 'badge-secondary' %>">
                                <%= livro.publicado ? 'Publicado' : 'No Acervo' %>
                            </span>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Disponibilidade</span>
                        <span class="info-value">
                            <span class="badge <%= livro.disponivel ? 'badge-success' : 'badge-error' %>">
                                <%= livro.disponivel ? 'Disponível' : 'Indisponível' %>
                            </span>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Última atualização</span>
                        <span class="info-value">
                            <%= livro.updatedAt ? new Date(livro.updatedAt).toLocaleDateString('pt-BR') : 'N/A' %>
                        </span>
                    </div>
                </div>
            </div>

            <div class="form-container">
                <form action="/catalogo/editar/<%= livro.id %>" method="POST">
                    <div class="form-group">
                        <label for="titulo" class="form-label">
                            <i class="fas fa-bookmark"></i> Título *
                        </label>
                        <input type="text" class="form-input" id="titulo" name="titulo" 
                               value="<%= livro.titulo %>" required>
                        <div class="form-text">Título completo do livro</div>
                    </div>

                    <div class="form-group">
                        <label for="autor" class="form-label">
                            <i class="fas fa-user"></i> Autor *
                        </label>
                        <input type="text" class="form-input" id="autor" name="autor" 
                               value="<%= livro.autor %>" required>
                        <div class="form-text">Nome completo do autor</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-image"></i> Capa do Livro
                        </label>
                        
                        <div class="capa-atual-container">
                            <p class="form-text">Capa atual:</p>
                            <% if (livro.capa_url) { %>
                                <img src="<%= livro.capa_url %>" alt="Capa atual de <%= livro.titulo %>" id="capa-atual-img" class="capa-atual">
                            <% } else { %>
                                <p id="capa-atual-img" class="form-text">Nenhuma capa cadastrada.</p>
                            <% } %>
                        </div>
                        <div class="capa-search-container">
                            <button type="button" class="btn btn-outline" id="btnBuscarCapa">
                                <i class="fas fa-search"></i> Buscar Nova Capa Online
                            </button>
                        </div>

                        <div id="resultados-capas" class="capas-results-grid">
                            </div>
                        
                        <input type="hidden" id="capa_url" name="capa_url" value="<%= livro.capa_url || '' %>">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="ano" class="form-label">
                                <i class="fas fa-calendar"></i> Ano de Publicação *
                            </label>
                            <input type="number" class="form-input" id="ano" name="ano" 
                                   value="<%= livro.ano %>" min="1450" max="<%= new Date().getFullYear() %>" required>
                            <div class="form-text">Ano de publicação original</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="categoria" class="form-label">
                                <i class="fas fa-tag"></i> Categoria *
                            </label>
                            <input type="text" class="form-input" id="categoria" name="categoria" 
                                   value="<%= livro.categoria %>" required>
                            <div class="form-text">Gênero literário</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="quantidade_total" class="form-label">
                            <i class="fas fa-hashtag"></i> Quantidade Total de Cópias *
                        </label>
                        <input type="number" class="form-input" id="quantidade_total" name="quantidade_total" 
                            value="<%= livro.quantidade_total %>" min="0" required>
                        <div class="form-text">
                            Total de cópias físicas deste livro. Atualmente, 
                            <strong><%= livro.quantidade_disponivel %></strong> estão disponíveis.
                        </div>
                    </div>


                    <div class="btn-group">
                        <a href="<%= livro.publicado ? '/catalogo' : '/catalogo/acervo' %>" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                        <button type="submit" class="btn" id="btnAtualizar">
                            <i class="fas fa-check-circle"></i> Atualizar Livro
                        </button>
                    </div>
                </form>
            </div>

            <% if (user && user.role === 'admin') { %>
            <div class="quick-actions">
                <h3 class="actions-title">
                    <i class="fas fa-bolt"></i> Ações Rápidas
                </h3>
                <div class="actions-grid">
                    <% if (!livro.publicado) { %>
                        <form action="/catalogo/publicar/<%= livro.id %>" method="POST">
                            <button type="submit" class="btn btn-success action-btn">
                                <i class="fas fa-megaphone"></i> Publicar no Catálogo
                            </button>
                        </form>
                    <% } else { %>
                        <form action="/catalogo/despublicar/<%= livro.id %>" method="POST">
                            <button type="submit" class="btn btn-warning action-btn" 
                                    onclick="return confirm('Tem certeza que deseja remover este livro do catálogo?')">
                                <i class="fas fa-arrow-left"></i> Mover para Acervo
                            </button>
                        </form>
                    <% } %>
                    <form action="/catalogo/remover/<%= livro.id %>" method="POST">
                        <button type="submit" class="btn btn-danger action-btn" 
                                onclick="return confirm('Tem certeza que deseja remover este livro permanentemente?')">
                            <i class="fas fa-trash"></i> Excluir Permanentemente
                        </button>
                    </form>
                </div>
            </div>
            <% } %>
        </div>

<%- include('partials/footer', {
    jsFile: 'editarLivro.js'
}) %>